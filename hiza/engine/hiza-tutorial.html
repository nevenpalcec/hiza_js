<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/nevenpalcec/hiza_js/main/hiza/engine/favicon.png">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.0/build/styles/atom-one-dark.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.0/build/highlight.min.js"></script>

    <!-- Hiža Engine -->
    <script>
        var DISABLE_HIZA_INIT = true;
    </script>
    <!-- To refresh CDN, use https://purge.jsdelivr.net/gh/nevenpalcec/hiza_js/hiza/engine/hiza.engine.js -->
    <script src="https://cdn.jsdelivr.net/gh/nevenpalcec/hiza_js/hiza/engine/hiza.engine.js"></script>
    <!-- <script src="./hiza.engine.js"></script> -->

    <style>

        body:not(.loaded) {
            opacity: 0;
        }

        body.loaded {
            animation: fade_in 1s forwards;
        }

        @keyframes fade_in {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .row {
            border-bottom: 1px solid lightgray;
            padding-bottom: 1rem;
            margin-bottom: 50px;
        }

        .page_title {
            font-family: 'Courier New', Courier, monospace;
            display: inline-block;
            cursor: pointer;
        }

        .page_title:hover {
            text-decoration: underline;
        }

        .page_title_sub {
            font-family: 'Courier New', Courier, monospace;
            display: inline-block;
            /* text-decoration: underline; */
        }

        .tutorial {
            padding: 5px 10px;
            /* border-bottom: 1px solid black; */
        }
        .tutorial pre {
            border: 1px solid lightgray;
            border-left: 4px solid #04AA6D;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 0;
        }
        .tutorial .result {
            padding: 5px;
            border: 1px solid lightgray;
            /* box-shadow: 3px 3px 3px gray; */
            word-wrap: break-word;
        }
        .tutorial .result::before {
            content: '<html>';
            display: block;
            color: #e06c75;
            font-size: 1.3rem;
            border-bottom: 1px solid lightgray;
            padding-bottom: 5px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

    <main class="container-fluid" style="padding: 0 100px;">

        <!-- Heading -->
        <header class="row">
            <div class="col-12 pt-4">
                <h1 class="page_title" onclick="window.open('https://github.com/nevenpalcec/hiza_js', '_blank');" style="color: #e06c75;">&lt;hiža&gt;</h1>
                &nbsp;&nbsp;&nbsp;
                <h1 class="page_title" onclick="window.open('https://raw.githubusercontent.com/nevenpalcec/hiza_js/main/hiza/demos/engine.html', '_blank');">Demo</h1>
                &nbsp;&nbsp;&nbsp;
                <h1 class="page_title_sub force_init">
                    <template hiza data-overwrite>
                        Ver_${ hiza.engine.ver }
                    </template>
                </h1>
            </div>
            
            <div class="col-md-6 mb-4">
                <input id="tutorial_search" class="form-control" type="text" placeholder="Search tutorial...">
            </div>
            <div class="col"></div>
        </header>

        <!-- How to import -->
        <div class="row tutorial_row force_init">
            <div class="col-md-12 tutorial">
                <h3> 1. Import </h3>

                <pre>
                    <code class="language-html">
                        &lt;!-- Get latest version --&gt;
                    &lt;script src="https://cdn.jsdelivr.net/gh/nevenpalcec/hiza_js/hiza/engine/hiza.engine.js"&gt;&lt;/script&gt;
            
                    <!-- &lt;!-- Get stable version --&gt;
                    &lt;script src="https://cdn.jsdelivr.net/gh/nevenpalcec/hiza_js/hiza/engine/hiza.engine-lts.js"&gt;&lt;/script&gt; -->
                    </code>
                </pre>
            </div>
        </div>

        <!-- Getting started -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 2. Getting started </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <!-- Generate HTML -->
                    <template hiza>
                        Hello ${ 'World' }!
                    </template>
                </div>
            </div>
        </div>

        <!-- $if, $else if, $else -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 3. Branching </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    
                    <template hiza>

                        $if (3 == 2) {
                            <h5> 3 == 2 </h5>
                        }
                        $else if (4 == 3) {
                            <h5> 4 == 3 </h5>
                        }
                        $else {
                            <h5> None of the conditions have been met. </h5>
                        }

                    </template>

                </div>
            </div>
        </div>

        <!-- Inline template (one-time) -->
        <div class="row tutorial_row d-none">
            <div class="col-md-6 tutorial">
                <h3>
                    Inline template
                </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <template hiza>
                        This is an inline template. <br>
                        Without [data-dest], its contents are put into <br>
                        a newly generated div element put after it.
                    </template>
                </div>
            </div>
        </div>

        <!-- Insert variables -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3>
                    4. Variables
                </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <script>
                        let example = 'Steve';
                    </script>

                    <template hiza>
                        Hello ${ example }
                    </template>
                </div>
            </div>
        </div>

        <!-- [data-interval] -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 5. [data-interval] </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <!-- Run each second -->
                    <template hiza data-interval="1000">
                        Time is ${ new Date().toLocaleTimeString() }
                    </template>
                </div>
            </div>
        </div>

        <!-- <script hiza-*> -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 6. Scripts inside template </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial d-none">
                <h3> &nbsp; </h3>
                <div class="result">
                    <template hiza>
                        <script hiza-sync>
                            // Runs during template generation
                        </script>

                        <script hiza-async>
                            // Runs during generation (inline await allowed)
                        </script>

                        <script hiza-defer>
                            // Runs after generated template is inserted
                        </script>

                        <script>
                            // Runs after generated template is inserted

                            // IMPORTANT: difference between HIŽA scripts and regular scripts inside the template is that HIŽA scripts can use HIŽA keywords
                        </script>
                    </template>
                </div>
            </div>
        </div>

        <!-- SCOPE keyword -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 7. Keywords </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <template hiza>
                        <script hiza-sync>
                            // Save value to local scope
                            SCOPE['obj_len'] = 13;
                            // Save value to global scope
                            GLOBAL['obj_len'] = 13;
                        </script>

                        <!-- Use scope variable -->
                        <p>
                            I have found ${obj_len} objects.
                        </p>
                    </template>

                    <!-- Use GLOBAL variable in another template -->
                    <template hiza>
                        I have found this in GLOBAL scope: ${ GLOBAL['obj_len'] }
                    </template>
                </div>
            </div>
        </div>

        <!-- Manual templating -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 8. Run manually </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                        <button class="btn btn-success w-100" onclick="cat_template.hiza.run()">Run</button>

                    <template id="cat_template" hiza>
                        <script hiza-async>

                            // Fetch example api
                            let res = await fetch('https://catfact.ninja/fact').then(res => res.json());

                            // Store globally
                            GLOBAL['cat_fact'] = res;
                        </script>

                        <p>
                            ${ GLOBAL['cat_fact']['fact'] }
                        </p>
                    </template>
                </div>
            </div>
        </div>

        <!-- [data-timeout] -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 9. [data-timeout] </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <div class="mb-2">
                        <button class="btn btn-success"
                            onclick="timeout_template.hiza.run()">Run with 1s delay</button>
                    </div>

                    <h4 id="timeout_container">
                    </h4>

                    <template id="timeout_template" hiza data-dest="#timeout_container" data-timeout="1000">
                        ${ new Date().toLocaleTimeString() }
                    </template>
                </div>
            </div>
        </div>

        <!-- Disable automatic init -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 10. Disable automatic init </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <script>
                        // Put before script import to ignore all hiža templates
                        var DISABLE_HIZA_INIT = true;
                    </script>

                    <!-- Ignore a single HIŽA template -->
                    <template hiza data-ignore_init>
                        I am not rendered.
                    </template>
                </div>
            </div>
        </div>

        <!-- SCOPE.DEST -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 11. SCOPE.DEST </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <p id="dest_example"></p>

                    <template hiza data-dest="#dest_example">
                        Hello world!

                        <!-- Change style of destination container -->
                        <script hiza-defer>
                            SCOPE.DEST.style.textAlign = 'center';
                        </script>
                    </template>
                </div>
            </div>
        </div>

        <!-- [data-overwrite] keyword -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 12. Overwriting </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    
                    <!-- Template with [data-dest] overwrites innerHTML -->
                    <p id="overwrite_dest_example">
                        I get overwritten.
                    </p>
                    <template hiza data-dest="#overwrite_dest_example">
                        Test
                    </template>

                    <!-- Template without [data-dest] will put result inplace -->
                    <p>
                        Before.
                        <template hiza>
                            Inside. 
                        </template>
                        After.
                    </p>

                </div>
            </div>
        </div>

        <!-- [data-url] and .load -->
        <div class="row tutorial_row">
            <div class="col-md-8 tutorial">
                <h3> 13. Remote sources </h3>
                <pre></pre>
            </div>

            <div class="col-md-4 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">

                    <!-- [data-url] fetches remote HTML and appends it to the template -->
                    <template hiza data-interval="1000" data-url="https://raw.githubusercontent.com/nevenpalcec/hiza_js/main/hiza/_src/page.hiza.html">

                        <script hiza-sync>
                            SCOPE['message'] = (SCOPE['message'] || 0) + 1;
                        </script>
                    </template>

                </div>
            </div>
        </div>

        <!-- $encode -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 14. $encode </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <template hiza>
                        <h1>Hello</h1>
                        
                        $encode {
                            <h1>Hello</h1>
                        }

                        <br>
                        <u>Note</u>: You must follow HTML rules to avoid incorrect encoding.<br>
                    </template>
                </div>
            </div>
        </div>

        <!-- $decode -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 15. $decode </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <template hiza>
                        
                        $decode {
                            This is an ampersand: &amp;amp;
                        }
                    </template>
                </div>
            </div>
        </div>

        <!-- $json -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 16. JSON </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">

                    <template hiza data-interval="1000">

                        <!-- Raw -->
                        <p>
                            Minified: <br>
                            $json {
                                {
                                    'a': 3,
                                    'b': 4
                                }
                            }
                        </p>

                        <!-- Formatted -->
                        <p>
                            Formatted: <br>
                            $formatted {
                                GLOBAL['cat_fact']
                            }
                        </p>
                    </template>

                    <!-- Tip: Update the cat fact (example no. 8) -->
                    <button class="btn btn-success w-100" onclick="cat_template.hiza.run()">Update cat fact</button>
                </div>
            </div>
        </div>

        <!-- $innertext -->
        <div class="row tutorial_row">
            <div class="col-md-6 tutorial">
                <h3> 17. $innertext </h3>
                <pre></pre>
            </div>

            <div class="col-md-6 tutorial">
                <h3> &nbsp; </h3>
                <div class="result">
                    <template hiza>
                        $innertext {
                            <div>
                                <p>
                                    Hey!
                                </p>
                                <p>
                                    I am in another paragraph.
                                </p>
                            </div>
                        }
                    </template>
                </div>
            </div>
        </div>

    </main>

<script>

tutorial_search.onkeyup = function() {

    document.querySelectorAll('.tutorial').forEach(div => {
    
        let s = div.innerText.toLowerCase();
        let v = tutorial_search.value.toLowerCase();
        if (s.includes(v)) {
            div.classList.remove('d-none');
        }
        else {
            div.classList.add('d-none');
        }
    });
};

async function copy(test) {
    await navigator.clipboard.writeText(text);
}

function raw(str) {
    return str.raw[0]
}

function apply_custom_color(code) {

    code = code.replace(/(\$(formatted|for|innertext|if|else if|else|json|encode|decode))/g,
        '<strong class="hljs-keyword">$1</strong>');
        
    code = code.replace(/(\$)\{/g, '<strong class="hljs-keyword">$1</strong>{');
    return code;
}

function highlight_code(pre) {

    console.log(pre.innerText);
    console.log(pre.innerHTML);

    let highlighted = hljs.highlightAuto(pre.innerText).value;
    pre.innerHTML = `<code class="language-html">${highlighted}</code>`;
    hljs.highlightElement(pre.children[0]);

    pre.children[0].innerHTML = apply_custom_color(pre.children[0].innerHTML);
}

async function on_load() {

    for (let templ of document.querySelectorAll('.force_init [hiza]')) {
        await hiza.engine.init_one(templ);
    }

    for (let row of document.querySelectorAll('.tutorial_row')) {

        let pre = row.querySelector('pre');
        let result = row.querySelector('.result');

        if (!result) {
            if (!pre.innerText) {
                pre.innerText = ' ';
            }
        }
        else {
            pre.innerText = result.innerHTML.replaceAll('=""', '');
        }


        pre.innerText = hiza.engine.decode(pre.innerText);
        pre.innerText = '\n    ' + pre.innerText.replaceAll(/\n                /g, '\n').trim() + '\n\n';

        if (row.classList.contains('ignore-init') == false) {
            
            for (let templ of row.querySelectorAll('[hiza]')) {

                if (templ.hasAttribute("data-ignore_init")) {
                    continue;
                }
                console.log('Initializing ' + templ.id);

                await hiza.engine.init_one(templ);
            }
        }

        highlight_code(pre);
    }

};

on_load().finally(function() {

    document.body.classList.add('loaded');
});

</script>

</body>
